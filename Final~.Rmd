---
title: "Final_"
author: "XunSun"
date: "`r Sys.Date()`"
output: html_document
---

# Setup and Libraries
```{r library}
library(tidyverse)
library(janitor)
library(ggplot2)
library(GGally)
library(dplyr)
library(gridExtra)
library(survival)
library(car)
library(PerformanceAnalytics)
library(glmnet)
library(caret)
library(pROC)
library(MASS)
library(writexl)
library(corrplot)
library(survivalROC)
set.seed(1)
```

```{r}
# Load the dataset
project_2_data <- read_csv("Project_2_data.csv", na = c("NA", "", ".")) |>
  janitor::clean_names() |>
  mutate(
    status = ifelse(status == "Dead", 1, 0),
    t_stage = case_when(t_stage == "T1" ~ 1, t_stage == "T2" ~ 2, t_stage == "T3" ~ 3, t_stage == "T4" ~ 4),
    n_stage = case_when(n_stage == "N1" ~ 1, n_stage == "N2" ~ 2, n_stage == "N3" ~ 3),
    differentiate = case_when(
      differentiate == "Well differentiated" ~ 1,
      differentiate == "Moderately differentiated" ~ 2,
      differentiate == "Poorly differentiated" ~ 3,
      differentiate == "Undifferentiated" ~ 4
    ),
    grade = as.numeric(as.character(grade)),
    a_stage_regional = ifelse(a_stage == "Regional", 1, 0),
    estrogen_status = ifelse(estrogen_status == "Positive", 1, 0),
    progesterone_status = ifelse(progesterone_status == "Positive", 1, 0)
  ) |>
  select(-a_stage) |>
  na.omit()

# Check missingness and descriptive statistics
summary(project_2_data)

```

```{r}
# Log transformations
project_2_data <- project_2_data |>
  mutate(
    log_tumor_size = log(tumor_size + 1),
    log_regional_node_examined = log(regional_node_examined + 1)
  )

# Visualize transformations
ggplot(project_2_data, aes(x = log_tumor_size)) +
  geom_histogram(fill = "blue", color = "black") +
  labs(title = "Log-Transformed Tumor Size")

ggplot(project_2_data, aes(x = log_regional_node_examined)) +
  geom_histogram(fill = "green", color = "black") +
  labs(title = "Log-Transformed Regional Nodes Examined")

```

```{r}
# Correlation matrix and multicollinearity
cor_matrix <- cor(project_2_data[, sapply(project_2_data, is.numeric)], use = "complete.obs")
corrplot(cor_matrix, method = "circle")

# Drop high VIF variables
project_2_data <- project_2_data |>
  select(-c(t_stage, n_stage, reginol_node_positive, differentiate))


```

```{r}
# Balance the dataset
dead <- project_2_data |> filter(status == 1)
alive <- project_2_data |> filter(status == 0) |> sample_n(nrow(dead))
balance_df <- bind_rows(dead, alive)

# Visualize balance
ggplot(balance_df, aes(x = status)) + geom_bar() + labs(title = "Balanced Dataset")

```

```{r}


```

