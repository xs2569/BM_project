---
title: "Final Project"
author: "Shiying Wu, Maggie Hsu"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup}
library(tidyverse)
library(survival)

#car package for vif
library(car)
#MASS package for var selection
library(MASS)

data <- read.csv("Project_2_data.csv")

sampledf <- data |>
  mutate(Status = ifelse(Status == "Dead", 1, 0))

dead <- sampledf |>
  filter(Status == 1)

alive <- sampledf |>
  filter(Status == 0) |>
  sample_n(nrow(dead))

final<-bind_rows(dead, alive) |>
  select(-Survival.Months) #error here, not sure how to address

logit_model <- glm(Status ~ ., data = final, family = binomial())

summary(logit_model)

predictions <- predict(logit_model, type = "response")

final$predicted_classes <- ifelse(predictions > 0.5, 1, 0)

confusionMatrix(as.factor(final$predicted_classes), as.factor(final$Status))
```
## Assumptions
```{r multicollinearity}
vif(logit_model)
# there are aliased coefficients in the model > means some vars have perfect multicoll. 
cor(sampledf)
#come back to this
  
```

## Variable selection

```{r vars}
#also i realize maybe lm isn't the best name since they're logit but i'll change the model names later

#Akaike Info Criterion
stepAIC(logit_model, trace=0, k = 2)
#model determined by AIC criterion: minimize AIC for better model fit
lm_aic <- glm(Status ~ Age + Race + Marital.Status + X6th.Stage + 
    differentiate + Estrogen.Status + Progesterone.Status + Regional.Node.Examined + 
    Reginol.Node.Positive, family = binomial(), data = sampledf)
#log likelihood
logLik(lm_aic)

#confusion matrix
predictions_aic <- predict(lm_aic, type = "response")
final_aic<-bind_rows(dead, alive) |>
  select(-Survival.Months) #error here but not sure how to address
final_aic$predicted_classes <- ifelse(predictions_aic > 0.5, 1, 0)
confusionMatrix(as.factor(final_aic$predicted_classes), as.factor(final_aic$Status))

#Bayesian Info Criterion
stepAIC(logit_model, trace=0, k = log(nrow(sampledf)))
#model determined by BIC criterion: minimize BIC for model fit
lm_bic <- glm(Status ~ differentiate + Progesterone.Status + 
    Regional.Node.Examined + Reginol.Node.Positive, family = binomial(), 
    data = sampledf)
#log likelihood
logLik(lm_bic)

#confusion matrix
predictions_bic <- predict(lm_bic, type = "response")
final_bic<-bind_rows(dead, alive) |>
  select(-Survival.Months) #same error as above
final_bic$predicted_classes <- ifelse(predictions_bic > 0.5, 1, 0)
confusionMatrix(as.factor(final_bic$predicted_classes), as.factor(final_bic$Status))

#full model LL 
logLik(logit_model)
```

```{r diagnostics}
#make diagnostic plots to address outlying observations and assumptions

#refit models using sensitivity-specificity plots and then check performance and sensitivity/specificity
```
